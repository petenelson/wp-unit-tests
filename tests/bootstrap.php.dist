<?php

class PN_WordPress_Unit_Tests {

	protected $_includes = array(
	);

	/**
	 * Setup the unit test environment
	 *
	 * @return void
	 */
	public function __construct() {

		$_tests_dir  = '';
		if ( ! is_dir( $_tests_dir ) ) {
			$_tests_dir = getenv( 'WP_TESTS_DIR' );
		}

		$root = dirname( __FILE__, 2 );

		// Load the composer autoload.
		if ( ! file_exists( $root . '/vendor/autoload.php' ) ) {
			throw new Exception(
				'ERROR' . PHP_EOL . PHP_EOL .
				'You must use Composer to install the test suite\'s dependencies.' . PHP_EOL
			);
		}

		$autoloader = require $root . '/vendor/autoload.php';

		if ( empty( $_tests_dir ) ) {
			throw new PHPUnit_Framework_Exception(
				'ERROR' . PHP_EOL . PHP_EOL .
				'You must define the WP_TESTS_DIR environment variable.' . PHP_EOL
			);
		}

		// Load the plugin.
		$this->load_plugin();

		// Start up the WP testing environment.
		require $_tests_dir . '/includes/bootstrap.php';
	}

	/**
	 * Loads the required files for the plugin.
	 *
	 * @return void
	 */
	private function load_plugin() {
		$root = dirname( __FILE__, 2 );
		foreach ( $this->_includes as $include ) {
			require_once $root . "/includes/{$include}.php";
		}
	}
}

new PN_WordPress_Unit_Tests();
